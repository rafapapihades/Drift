<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DRIFT SHOW LIVE</title>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, onValue, update, increment } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = { databaseURL: "https://lectura-sonido-drift-show-default-rtdb.firebaseio.com" };
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // Estado de Pista
        onValue(ref(db, 'estado_pista'), s => {
            const p = s.val();
            const b = document.getElementById('banner');
            b.innerText = p.mensaje; b.style.background = p.color;
        });

        // Ranking Escapes
        onValue(ref(db, 'ranking_escapes'), s => {
            const data = s.val();
            const list = document.getElementById('lista');
            list.innerHTML = '';
            if(data) {
                Object.values(data).sort((a,b)=>b.db - a.db).forEach((e, i) => {
                    list.innerHTML += `<div class="item"><b>#${i+1}</b> ${e.piloto} <span>${e.db} dB</span></div>`;
                });
            }
        });

        // VotaciÃ³n Drift
        let yaVoto = false;
        onValue(ref(db, 'votacion_activa'), s => {
            const v = s.val();
            const div = document.getElementById('votos');
            if(v?.activa) {
                div.style.display = 'block';
                document.getElementById('v-info').innerText = "VOTAR DORSAL: " + v.dorsal;
                yaVoto = false;
            } else div.style.display = 'none';
        });

        window.votar = (t) => {
            if(yaVoto) return alert("Ya votaste");
            update(ref(db, 'votacion_activa'), { [t]: increment(1) });
            yaVoto = true; alert("Â¡Gracias!");
        };
    </script>
    <style>
        body { background: #000; color: white; font-family: sans-serif; text-align: center; margin:0; padding:10px;}
        #banner { padding: 15px; font-weight: bold; position: sticky; top: 0; z-index: 100; border-radius: 0 0 10px 10px; margin-bottom: 10px;}
        .item { background: #111; padding: 15px; margin-bottom: 5px; border-radius: 8px; display: flex; justify-content: space-between; border-left: 4px solid #ffcc00;}
        #votos { background: #222; padding: 20px; border-radius: 20px; border: 2px solid #ffcc00; margin: 10px 0; }
        .v-btns { display: flex; justify-content: space-around; font-size: 3em; }
    </style>
</head>
<body>
    <div id="banner">ESPERANDO PISTA...</div>
    
    <div id="votos" style="display:none">
        <h2 id="v-info">VOTAR</h2>
        <div class="v-btns">
            <span onclick="votar('aplausos')">ğŸ‘</span>
            <span onclick="votar('like')">ğŸ‘</span>
            <span onclick="votar('dislike')">ğŸ‘</span>
        </div>
    </div>

    <h3>ğŸ”Š TOP ESCAPES</h3>
    <div id="lista">Cargando...</div>
</body>
</html>
